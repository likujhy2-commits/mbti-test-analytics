<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나의 일경험 유형은?</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        .container {
            text-align: center;
            background-color: #fff;
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        h1 {
            font-size: 2.5em;
            color: #4a90e2;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 20px;
        }

        p {
            font-size: 1.1em;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #555;
        }

        .start-button, .view-analytics-button {
            padding: 18px 40px;
            font-size: 1.2em;
            font-weight: bold;
            color: #fff;
            background: linear-gradient(45deg, #4a90e2, #357bd8);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(74, 144, 226, 0.3);
            margin-bottom: 15px; /* Added margin for spacing */
        }

        .start-button:hover, .view-analytics-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(74, 144, 226, 0.4);
        }

        .start-button:active, .view-analytics-button:active {
            transform: translateY(-1px);
        }

        .info {
            margin-top: 20px;
            font-size: 0.9em;
            color: #888;
        }

        /* 테스트 페이지 스타일 */
        .test-container {
            max-width: 600px;
            width: 90%;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px 30px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4a90e2, #357bd8);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .question-number {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .question {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 30px;
            line-height: 1.4;
            color: #333;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #fafafa;
            text-align: left;
        }

        .option:hover {
            border-color: #4a90e2;
            background-color: #f0f7ff;
            transform: translateY(-2px);
        }

        .option.selected {
            border-color: #4a90e2;
            background-color: #e3f2fd;
        }

        .next-button {
            margin-top: 30px;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            color: #fff;
            background: linear-gradient(45deg, #4a90e2, #357bd8);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.5;
            pointer-events: none;
        }

        .next-button.active {
            opacity: 1;
            pointer-events: auto;
        }

        .next-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(74, 144, 226, 0.3);
        }

        /* 결과 페이지 스타일 */
        .result-container {
            max-width: 700px;
            width: 90%;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px 30px;
            display: none;
        }

        .result-type {
            font-size: 3em;
            font-weight: bold;
            color: #4a90e2;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .result-description {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #555;
        }

        .traits {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .trait {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #4a90e2;
        }

        .trait-title {
            font-weight: bold;
            color: #4a90e2;
            margin-bottom: 5px;
        }

        .trait-desc {
            font-size: 0.9em;
            color: #666;
        }

        .restart-button, .view-analytics-button-result {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            color: #4a90e2;
            background-color: transparent;
            border: 2px solid #4a90e2;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .restart-button:hover, .view-analytics-button-result:hover {
            background-color: #4a90e2;
            color: #fff;
            transform: translateY(-2px);
        }

        /* 데이터 분석 페이지 스타일 */
        .analytics-container {
            max-width: 800px;
            width: 90%;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px 30px;
            display: none;
        }

        .analytics-container h2 {
            font-size: 2em;
            color: #4a90e2;
            margin-bottom: 25px;
            font-weight: 700;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analytics-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border-left: 5px solid #764ba2;
        }

        .analytics-card-title {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 10px;
        }

        .analytics-card-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #764ba2;
        }

        .chart-container {
            margin-bottom: 30px;
        }

        .chart-container canvas {
            max-width: 100%;
            height: auto;
        }
        .back-to-home-button {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
            background-color: transparent;
            border: 2px solid #667eea;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .back-to-home-button:hover {
            background-color: #667eea;
            color: #fff;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>

<div class="container" id="startPage">
    <h1>나의 일경험 유형은?</h1>
    <div class="subtitle">Myers-Briggs Type Indicator</div>
    <p>설문을 통해 나의 일경험 유형을 확인해보세요!</p>
    <button class="start-button" onclick="startTest()">테스트 시작하기</button>
    <button class="view-analytics-button" onclick="showAnalyticsPage()">데이터 분석 보기</button>
    <div class="info">⏱️ 소요시간: 약 5분</div>
</div>

<div class="test-container" id="testPage">
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="question-number" id="questionNumber">질문 1 / 15</div>
    <div class="question" id="questionText"></div>
    <div class="options" id="options"></div>
    <button class="next-button" id="nextButton" onclick="nextQuestion()">다음 질문</button>
</div>

<div class="result-container" id="resultPage">
    <div class="result-type" id="resultType"></div>
    <div class="result-title" id="resultTitle"></div>
    <div class="result-description" id="resultDescription"></div>
    <div class="traits" id="traits"></div>
    <button class="restart-button" onclick="restartTest()">다시 테스트하기</button>
    <button class="view-analytics-button-result" onclick="showAnalyticsPage()">데이터 분석 보기</button>
</div>

<div class="analytics-container" id="analyticsPage">
    <h2>📊 테스트 데이터 분석</h2>
    <div class="analytics-grid">
        <div class="analytics-card">
            <div class="analytics-card-title">총 테스트 수</div>
            <div class="analytics-card-value" id="totalTests">0</div>
        </div>
        <div class="analytics-card">
            <div class="analytics-card-title">고유 사용자 수</div>
            <div class="analytics-card-value" id="uniqueUsers">0</div>
        </div>
        <div class="analytics-card">
            <div class="analytics-card-title">가장 많은 유형</div>
            <div class="analytics-card-value" id="mostFrequentType">-</div>
        </div>
        <div class="analytics-card">
            <div class="analytics-card-title">평균 완료 시간(분)</div>
            <div class="analytics-card-value" id="avgCompletionTime">0</div>
        </div>
    </div>

    <div class="chart-container">
        <h3>MBTI 유형별 분포</h3>
        <canvas id="mbtiTypeChart"></canvas>
    </div>

    <div class="chart-container">
        <h3>4차원별 분포</h3>
        <canvas id="dimensionChart"></canvas>
    </div>
    
    <button class="back-to-home-button" onclick="goToHomePage()">결과로 돌아가기</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // MBTI 질문 데이터 (기존 mbti-test.html 내용과 동일)
    const questions = [
        // 챕터 1: 일경험 선호도 조사
        {
            question: "나는 어떤 형태의 일경험이 가장 흥미로운가?",
            options: [
                { text: "실무 중심의 일겨험", type: "C1Q1A" },
                { text: "다양한 직무를 체험하는 단기 프로그램", type: "C1Q1B" },
                { text: "창업·프로젝트 참여형 활동", type: "C1Q1C" },
                { text: "타지역에서 경험할 수 있는 활동", type: "C1Q1D" }
            ]
        },
        {
            question: "일경험에서 가장 기대하는 것은?",
            options: [
                { text: "전문 스킬·실무 역량 습득", type: "C1Q2A" },
                { text: "현직자와의 네트워킹/멘토링", type: "C1Q2B" },
                { text: "포트폴리오 확보", type: "C1Q2C" },
                { text: "직장생활 경험", type: "C1Q2D" }
            ]
        },
        {
            question: "일경험 참여 시 가장 신경 쓰이는 점은?",
            options: [
                { text: "급여·지원금의 부족함", type: "C1Q3A" },
                { text: "참여 기간과 신청 일정", type: "C1Q3B" },
                { text: "원하는 직무와의 연계성", type: "C1Q3C" },
                { text: "정보 접근성과 모집 방법의 부재", type: "C1Q3D" }
            ]
        },
        {
            question: "선호하는 일경험 기간은?",
            options: [
                { text: "1개월 이하 단기 프로그램", type: "C1Q4A" },
                { text: "3개월 단기 집중형", type: "C1Q4B" },
                { text: "5개월 중·장기형", type: "C1Q4C" },
                { text: "6개월 이상 장기형", type: "C1Q4D" }
            ]
        },
        {
            question: "일경험 후 가장 기대하는 성과는?",
            options: [
                { text: "취업 연계/정규직 기회", type: "C1Q5A" },
                { text: "경력 형성 및 포트폴리오 강화", type: "C1Q5B" },
                { text: "자기 성장과 진로 탐색", type: "C1Q5C" },
                { text: "인맥 형성 및 네트워킹", type: "C1Q5D" }
            ]
        },
        // 챕터 2: 나의 일경험 유형 (직무유형 테스트)
        {
            question: "업무를 수행할 때 나는 주로?",
            options: [
                { text: "계획대로 꼼꼼하게 해야한다.", type: "C2Q1A" },
                { text: "새로운 방법을 시도하며 유연하게 일한다.", type: "C2Q1B" },
                { text: "사람들과 협업하며 아이디어를 나누는 걸 선호한다,", type: "C2Q1C" },
                { text: "혼자 집중해서 몰입하며 해결하는걸 선호한다.", type: "C2Q1D" }
            ]
        },
        {
            question: "나는 문제를 마주하면?",
            options: [
                { text: "매뉴얼/정형화된 방법으로 해결한다,", type: "C2Q2A" },
                { text: "새로운 해결책을 찾아본다", type: "C2Q2B" },
                { text: "직장동료, 상사와 상의 후 결정한다.", type: "C2Q2C" },
                { text: "먼저 시도해보고 결과를 보며 조정한다.", type: "C2Q2D" }
            ]
        },
        {
            question: "내가 가장 좋아하는 역할은?",
            options: [
                { text: "계획하고 정리하는 역할", type: "C2Q3A" },
                { text: "새로운 아이디어를 제시하는 역할", type: "C2Q3B" },
                { text: "사람들과 대화가 너무 좋아요! 커뮤니케이션 역할", type: "C2Q3C" },
                { text: "모든일 내가한다! 부지런한 일개미 역할", type: "C2Q3D" }
            ]
        },
        {
            question: "나는 업무 성과를 평가받을 때?",
            options: [
                { text: "정해진 기준·성과 목표 달성 여부", type: "C2Q4A" },
                { text: "창의적 시도와 새로운 결과", type: "C2Q4B" },
                { text: "팀과 함께 협력한 과정과 결과", type: "C2Q4C" },
                { text: "혼자 성취한 실질적 결과", type: "C2Q4D" }
            ]
        },
        {
            question: "나는 일할 때 가장 중요하게 생각하는 가치?",
            options: [
                { text: "안정성과 예측 가능성", type: "C2Q5A" },
                { text: "도전과 창의성", type: "C2Q5B" },
                { text: "사람들과의 관계·협업", type: "C2Q5C" },
                { text: "개인 성취감·전문성", type: "C2Q5D" }
            ]
        },
        // 챕터 3: 내가 자주 사용하는 SNS와 선호 게시물 유형
        {
            question: "가장 자주 사용하는 SNS는?",
            options: [
                { text: "인스타그램", type: "C3Q1A" },
                { text: "유튜브", type: "C3Q1B" },
                { text: "틱톡", type: "C3Q1C" },
                { text: "페이스북", type: "C3Q1D" },
                { text: "기타(네이버 카페, 디스코드 등)", type: "C3Q1E" }
            ]
        },
        {
            question: "하루 평균 SNS 사용 시간은?",
            options: [
                { text: "1시간 미만", type: "C3Q2A" },
                { text: "1~2시간", type: "C3Q2B" },
                { text: "2~3시간", type: "C3Q2C" },
                { text: "3시간 이상", type: "C3Q2D" }
            ]
        },
        {
            question: "SNS에서 주로 보는 콘텐츠 유형은?",
            options: [
                { text: "짧은 영상/릴스", type: "C3Q3A" },
                { text: "카드뉴스·정보형 포스트", type: "C3Q3B" },
                { text: "친구·커뮤니티 게시글", type: "C3Q3C" },
                { text: "공식 기관·브랜드 공지/소식", type: "C3Q3D" }
            ]
        },
        {
            question: "일경험 관련 정보를 얻을 때 선호하는 방식은?",
            options: [
                { text: "영상/카드뉴스 콘텐츠", type: "C3Q4A" },
                { text: "SNS 포스트나 커뮤니티 공유", type: "C3Q4B" },
                { text: "웹사이트·포털 검색", type: "C3Q4C" },
                { text: "공공기관·청년센터 공식 채널", type: "C3Q4D" }
            ]
        },
        {
            question: "SNS에서 가장 참여하고 싶은 활동은?",
            options: [
                { text: "댓글·좋아요 등 간단 참여", type: "C3Q5A" },
                { text: "이벤트·퀴즈 참여", type: "C3Q5B" },
                { text: "실시간 라이브/질문 참여", type: "C3Q5C" },
                { text: "직접 콘텐츠 제작·공유", type: "C3Q5D" }
            ]
        }
    ];

    const mbtiResults = {
        "감자군": {
            title: "감자군",
            description: "차분하게 내 길을 가는 안정형. 느리지만 꾸준하게, 묵묵히 일하는 신뢰형 친구.",
            traits: [{ title: "안정형", desc: "차분하고 신뢰감 있음" }]
        },
        "바나니": {
            title: "바나니",
            description: "계획적이고 튼튼한 기반, 팀과 함께 성장을 즐기는 안정형 리더.",
            traits: [{ title: "안정형", desc: "차분하고 신뢰감 있음" }]
        },
        "애플링": {
            title: "애플링",
            description: "꼼꼼하고 균형 잡힌 감각, 숫자와 데이터를 사랑하는 안정형 천재.",
            traits: [{ title: "안정형", desc: "차분하고 신뢰감 있음" }]
        },
        "배링": {
            title: "배링",
            description: "꼼꼼하게 체크하며 실수를 최소화, 안정감 있는 신뢰형 일꾼.",
            traits: [{ title: "안정형", desc: "차분하고 신뢰감 있음" }]
        },
        "딸기팡": {
            title: "딸기팡",
            description: "사람들과 친근하게 소통하고 분위기 메이커, 팀워크를 즐기는 연결형.",
            traits: [{ title: "연결형", desc: "사람들과 소통, 팀워크 즐김" }]
        },
        "체리링": {
            title: "체리링",
            description: "상큼하게 소통하며 관계를 매끄럽게 연결하는 사람 중심형 캐릭터.",
            traits: [{ title: "연결형", desc: "사람들과 소통, 팀워크 즐김" }]
        },
        "망고몽": {
            title: "망고몽",
            description: "부드럽고 친근하게 상대방 마음을 읽는 연결형, 상담 전문가.",
            traits: [{ title: "연결형", desc: "사람들과 소통, 팀워크 즐김" }]
        },
        "오렌지팟": {
            title: "오렌지팟",
            description: "다채로운 사람들과 활발히 소통하며 지식을 전달하는 연결형.",
            traits: [{ title: "연결형", desc: "사람들과 소통, 팀워크 즐김" }]
        },
        "수박팡": {
            title: "수박팡",
            description: "시원하고 큰 매력, 다수와 즐겁게 소통하며 관계 형성을 좋아하는 연결형.",
            traits: [{ title: "연결형", desc: "사람들과 소통, 팀워크 즐김" }]
        },
        "파인팡": {
            title: "파인팡",
            description: "독창적이고 창의력 폭발, 도전을 즐기는 탐험형 연구자.",
            traits: [{ title: "탐험형", desc: "창의적이고 도전 정신 강함" }]
        },
        "키위킹": {
            title: "키위킹",
            description: "겉보기 평범하지만 속은 혁신적, 새로운 시도를 즐기는 탐험형.",
            traits: [{ title: "탐험형", desc: "창의적이고 도전 정신 강함" }]
        },
        "블루팡": {
            title: "블루팡",
            description: "작지만 강력한 아이디어, 창의적 감각이 뛰어난 탐험형.",
            traits: [{ title: "탐험형", desc: "창의적이고 도전 정신 강함" }]
        },
        "레모링": {
            title: "레모링",
            description: "톡 쏘는 도전 정신, 강렬하고 에너지 넘치는 탐험형 창업가.",
            traits: [{ title: "탐험형", desc: "창의적이고 도전 정신 강함" }]
        },
        "포도군": {
            title: "포도군",
            description: "묵묵히 일하며 결과를 만들어내는 몰입형, 팀 속에서도 집중력 최고.",
            traits: [{ title: "집중형", desc: "몰입과 집중, 실질적 성과 중심" }]
        },
        "레드애플": {
            title: "레드애플",
            description: "체계적이고 효율적, 실용적이고 안정적인 집중형.",
            traits: [{ title: "집중형", desc: "몰입과 집중, 실질적 성과 중심" }]
        },
        "단배링": {
            title: "단배링",
            description: "든든하고 묵묵히 지키는 안정적 집중형, 책임감 끝판왕.",
            traits: [{ title: "집중형", desc: "몰입과 집중, 실질적 성과 중심" }]
        }
    };

    let currentQuestion = 0;
    // 모든 캐릭터의 점수를 0으로 초기화
    let answers = {
        "감자군": 0, "바나니": 0, "애플링": 0, "배링": 0,
        "파인팡": 0, "키위킹": 0, "블루팡": 0, "레모링": 0,
        "딸기팡": 0, "체리링": 0, "망고몽": 0, "오렌지팟": 0, "수박팡": 0,
        "포도군": 0, "레드애플": 0, "단배링": 0
    };
    let selectedOption = null;
    let testStartTime;

    // 캐릭터 유형 및 우선순위 정의 (동점 처리용)
    const characterTypes = {
        "안정형": ["감자군", "바나니", "애플링", "배링"],
        "탐험형": ["파인팡", "키위킹", "블루팡", "레모링"],
        "연결형": ["딸기팡", "체리링", "망고몽", "오렌지팟", "수박팡"],
        "집중형": ["포도군", "레드애플", "단배링"]
    };

    const typePriority = ["탐험형", "연결형", "집중형", "안정형"]; // 우선순위: 탐험형 > 연결형 > 집중형 > 안정형

    // 선택지 매핑 (질문 2의 C, D 선택지 수정 필요)
    const optionToCharactersMap = {
        // 챕터 2: 나의 일경험 유형 (직무유형 테스트)
        "C2Q1A": ["감자군", "바나니", "애플링", "배링"], // 계획대로 꼼꼼하게
        "C2Q1B": ["파인팡", "키위킹", "블루팡", "레모링"], // 새로운 방법을 시도
        "C2Q1C": ["딸기팡", "체리링", "망고몽", "오렌지팟", "수박팡"], // 사람들과 협업하며 아이디어를 나누는 걸 선호한다,
        "C2Q1D": ["포도군", "레드애플", "단배링"], // 혼자 집중해서 몰입하며 해결하는걸 선호한다.

        "C2Q2A": ["감자군", "바나니", "애플링", "배링"], // 매뉴얼/정형화
        "C2Q2B": ["파인팡", "키위킹", "블루팡", "레모링"], // 새로운 해결책
        "C2Q2C": ["딸기팡", "체리링", "망고몽", "오렌지팟", "수박팡"], // 직장동료, 상사와 상의 후 결정한다.
        "C2Q2D": ["포도군", "레드애플", "단배링"], // 먼저 시도 후 조정한다.

        "C2Q3A": ["감자군", "바나니", "애플링", "배링"], // 계획하고 정리하는 역할
        "C2Q3B": ["파인팡", "키위킹", "블루팡", "레모링"], // 새로운 아이디어를 제시하는 역할
        "C2Q3C": ["딸기팡", "체리링", "망고몽", "오렌지팟", "수박팡"], // 커뮤니케이션 역할
        "C2Q3D": ["포도군", "레드애플", "단배링"], // 모든 일 직접 수행! 부지런한 일개미 역할

        "C2Q4A": ["감자군", "바나니", "애플링", "배링"], // 정해진 기준·성과 목표 달성 여부
        "C2Q4B": ["파인팡", "키위킹", "블루팡", "레모링"], // 창의적 시도와 새로운 결과
        "C2Q4C": ["딸기팡", "체리링", "망고몽", "오렌지팟", "수박팡"], // 팀과 함께 협력한 과정과 결과
        "C2Q4D": ["포도군", "레드애플", "단배링"], // 혼자 성취한 실질적 결과

        "C2Q5A": ["감자군", "바나니", "애플링", "배링"], // 안정성과 예측 가능성
        "C2Q5B": ["파인팡", "키위킹", "블루팡", "레모링"], // 도전과 창의성
        "C2Q5C": ["딸기팡", "체리링", "망고몽", "오렌지팟", "수박팡"], // 사람들과의 관계·협업
        "C2Q5D": ["포도군", "레드애플", "단배링"]  // 개인 성취감·전문성
    };

    // 데이터 저장 및 로드
    function getAnalyticsData() {
        return JSON.parse(localStorage.getItem('mbtiAnalytics')) || {
            totalTests: 0,
            uniqueUsers: [],
            mbtiTypeCounts: {
                "감자군": 0, "바나니": 0, "애플링": 0, "배링": 0,
                "파인팡": 0, "키위킹": 0, "블루팡": 0, "레모링": 0,
                "딸기팡": 0, "체리링": 0, "망고몽": 0, "오렌지팟": 0, "수박팡": 0,
                "포도군": 0, "레드애플": 0, "단배링": 0
            },
            dimensionCounts: {
                "안정형": 0, "탐험형": 0, "연결형": 0, "집중형": 0
            },
            completionTimes: []
        };
    }

    function saveAnalyticsData(data) {
        localStorage.setItem('mbtiAnalytics', JSON.stringify(data));
    }

    function startTest() {
        document.getElementById('startPage').style.display = 'none';
        document.getElementById('testPage').style.display = 'block';
        currentQuestion = 0;
        // 모든 캐릭터의 점수를 0으로 초기화
        answers = {
            "감자군": 0, "바나니": 0, "애플링": 0, "배링": 0,
            "파인팡": 0, "키위킹": 0, "블루팡": 0, "레모링": 0,
            "딸기팡": 0, "체리링": 0, "망고몽": 0, "오렌지팟": 0, "수박팡": 0,
            "포도군": 0, "레드애플": 0, "단배링": 0
        };
        selectedOption = null;
        testStartTime = new Date(); // 테스트 시작 시간 기록
        showQuestion();
    }

    function showQuestion() {
        const question = questions[currentQuestion];
        const progress = ((currentQuestion + 1) / questions.length) * 100;
        
        document.getElementById('progressFill').style.width = progress + '%';
        document.getElementById('questionNumber').textContent = `질문 ${currentQuestion + 1} / ${questions.length}`;
        document.getElementById('questionText').textContent = question.question;
        
        const optionsContainer = document.getElementById('options');
        optionsContainer.innerHTML = '';
        
        question.options.forEach((option, index) => {
            const optionElement = document.createElement('div');
            optionElement.className = 'option';
            optionElement.textContent = option.text;
            optionElement.onclick = () => selectOption(index, optionElement);
            optionsContainer.appendChild(optionElement);
        });
        
        document.getElementById('nextButton').classList.remove('active');
        selectedOption = null;
    }

    function selectOption(index, element) {
        document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
        element.classList.add('selected');
        selectedOption = index;
        document.getElementById('nextButton').classList.add('active');
    }

    function nextQuestion() {
        if (selectedOption === null) return;
        
        const question = questions[currentQuestion];
        const selectedAnswerType = question.options[selectedOption].type;

        // 캐릭터 점수 증가
        if (optionToCharactersMap[selectedAnswerType]) {
            optionToCharactersMap[selectedAnswerType].forEach(character => {
                answers[character]++;
            });
        }

        currentQuestion++;
        
        if (currentQuestion < questions.length) {
            showQuestion();
        } else {
            const testEndTime = new Date();
            const completionTime = (testEndTime - testStartTime) / 1000 / 60; // 분 단위

            // 결과 계산 후 분석 데이터 업데이트
            const resultCharacter = calculateResultCharacter();
            updateAnalyticsData(resultCharacter, completionTime);
            showResult(resultCharacter);
        }
    }

    function calculateResultCharacter() {
        let maxScore = -1;
        let resultCharacters = [];

        // 가장 높은 점수를 가진 캐릭터 찾기
        for (const character in answers) {
            if (answers[character] > maxScore) {
                maxScore = answers[character];
                resultCharacters = [character];
            } else if (answers[character] === maxScore) {
                resultCharacters.push(character);
            }
        }

        // 동점 처리
        if (resultCharacters.length > 1) {
            for (const priorityType of typePriority) {
                const charactersInPriorityType = characterTypes[priorityType];
                for (const char of resultCharacters) {
                    if (charactersInPriorityType.includes(char)) {
                        return char; // 가장 높은 우선순위의 캐릭터 반환
                    }
                }
            }
        }
        return resultCharacters[0]; // 단일 캐릭터 또는 우선순위가 없는 경우 첫 번째 캐릭터 반환
    }

    function updateAnalyticsData(resultCharacter, completionTime) {
        let analyticsData = getAnalyticsData();
        analyticsData.totalTests++;
        
        // 고유 사용자 수 (간단한 식별자로 현재는 IP나 기기 정보 없이 단순 카운트)
        // 실제 서비스에서는 고유 사용자 식별 로직 필요
        if (!analyticsData.uniqueUsers.includes(navigator.userAgent)) { // 브라우저 정보로 단순 식별
            analyticsData.uniqueUsers.push(navigator.userAgent);
        }

        // 캐릭터별 카운트 업데이트
        analyticsData.mbtiTypeCounts[resultCharacter] = (analyticsData.mbtiTypeCounts[resultCharacter] || 0) + 1;
        
        // 4차원별 분포 (새로운 유형으로 변경) 업데이트
        for (const typeKey in characterTypes) {
            if (characterTypes[typeKey].includes(resultCharacter)) {
                analyticsData.dimensionCounts[typeKey]++;
                break;
            }
        }

        analyticsData.completionTimes.push(completionTime);
        saveAnalyticsData(analyticsData);
    }

    function showResult(resultCharacter) {
        const result = mbtiResults[resultCharacter];
        
        document.getElementById('testPage').style.display = 'none';
        document.getElementById('resultPage').style.display = 'block';
        
        document.getElementById('resultType').textContent = resultCharacter;
        document.getElementById('resultTitle').textContent = result.title;
        document.getElementById('resultDescription').textContent = result.description;
        
        const traitsContainer = document.getElementById('traits');
        traitsContainer.innerHTML = '';
        
        result.traits.forEach(trait => {
            const traitElement = document.createElement('div');
            traitElement.className = 'trait';
            traitElement.innerHTML = `
                <div class="trait-title">${trait.title}</div>
                <div class="trait-desc">${trait.desc}</div>
            `;
            traitsContainer.appendChild(traitElement);
        });
    }

    function restartTest() {
        currentQuestion = 0;
        // 모든 캐릭터의 점수를 0으로 초기화
        answers = {
            "감자군": 0, "바나니": 0, "애플링": 0, "배링": 0,
            "파인팡": 0, "키위킹": 0, "블루팡": 0, "레모링": 0,
            "딸기팡": 0, "체리링": 0, "망고몽": 0, "오렌지팟": 0, "수박팡": 0,
            "포도군": 0, "레드애플": 0, "단배링": 0
        };
        selectedOption = null;
        
        document.getElementById('resultPage').style.display = 'none';
        document.getElementById('startPage').style.display = 'block';
    }

    let mbtiTypeChartInstance = null;
    let dimensionChartInstance = null;

    function showAnalyticsPage() {
        document.getElementById('startPage').style.display = 'none';
        document.getElementById('testPage').style.display = 'none';
        document.getElementById('resultPage').style.display = 'none';
        document.getElementById('analyticsPage').style.display = 'block';
        
        loadAnalyticsData();
    }

    function loadAnalyticsData() {
        const analyticsData = getAnalyticsData();

        document.getElementById('totalTests').textContent = analyticsData.totalTests;
        document.getElementById('uniqueUsers').textContent = analyticsData.uniqueUsers.length;

        // 가장 많은 유형 찾기
        let mostFrequentType = '-';
        let maxCount = 0;
        for (const type in analyticsData.mbtiTypeCounts) {
            if (analyticsData.mbtiTypeCounts[type] > maxCount) {
                maxCount = analyticsData.mbtiTypeCounts[type];
                mostFrequentType = type;
            } else if (analyticsData.mbtiTypeCounts[type] === maxCount && maxCount > 0) {
                // 동점 처리 (우선순위는 여기서 직접 처리하지 않고, calculateResultCharacter에서 결정된 결과를 사용)
                // 여기서는 단순히 가장 많은 유형을 표시
                // 여러 개가 동점일 경우, 첫 번째로 발견된 유형을 표시
            }
        }
        document.getElementById('mostFrequentType').textContent = mostFrequentType;

        // 평균 완료 시간
        const totalCompletionTime = analyticsData.completionTimes.reduce((sum, time) => sum + time, 0);
        const avgCompletionTime = analyticsData.completionTimes.length > 0 ? (totalCompletionTime / analyticsData.completionTimes.length).toFixed(2) : 0;
        document.getElementById('avgCompletionTime').textContent = avgCompletionTime;

        // 캐릭터별 분포 차트
        const characterLabels = Object.keys(analyticsData.mbtiTypeCounts).sort();
        const characterData = characterLabels.map(label => analyticsData.mbtiTypeCounts[label] || 0);

        if (mbtiTypeChartInstance) {
            mbtiTypeChartInstance.destroy();
        }
        mbtiTypeChartInstance = new Chart(document.getElementById('mbtiTypeChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: characterLabels,
                datasets: [{
                    label: '캐릭터별 테스트 수',
                    data: characterData,
                    backgroundColor: 'rgba(74, 144, 226, 0.6)',
                    borderColor: 'rgba(74, 144, 226, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: '캐릭터별 분포'
                    }
                }
            }
        });

        // 4차원별 분포 차트 (새로운 유형으로 변경)
        const dimensionLabels = ["안정형", "탐험형", "연결형", "집중형"];
        const dimensionData = dimensionLabels.map(label => analyticsData.dimensionCounts[label] || 0);

        if (dimensionChartInstance) {
            dimensionChartInstance.destroy();
        }
        dimensionChartInstance = new Chart(document.getElementById('dimensionChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: dimensionLabels,
                datasets: [{
                    label: '유형별 테스트 수',
                    data: dimensionData,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.6)',
                        'rgba(54, 162, 235, 0.6)',
                        'rgba(255, 206, 86, 0.6)',
                        'rgba(75, 192, 192, 0.6)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: '4가지 유형별 분포'
                    }
                }
            }
        });
    }

    function goToHomePage() {
        document.getElementById('analyticsPage').style.display = 'none';
        document.getElementById('startPage').style.display = 'block';
    }
</script>

</body>
</html>
